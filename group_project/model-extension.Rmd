---
title: "Untitled"
author: "mads weise"
date: "2025-03-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



```{r}

#VARIABLES
#CL  #live coral on open substrate
#CD  #dead coral
#CP #Live coral on dead coral
#ME #Exposed macroalgae
#MP #Protected macroalgae
#S #Empty space; colonizable by coral or macroalgae

#PARAMETERS (change in proportional cover/year)
gc <- 0.1 #growth rate of coral
gm <- 0.6 #growth rate of macroalgae
gmc <- 0.06 #Overgrowth rate of macroalgae onto live coral
dc <- 0.001 #Death rate of coral
dm <- 0.05 #Senescence rate of macroalgae
e <- 0.01 #Erosion rate of dead coral
gammaC <- 0.001 #Open settlement rate of coral
settlement <- 1 #Multiplier for rate of coral settlement onto dead coral
gammaM <- 0.001 #Open settlement rate of macroalgae
h <- 0.3 #Ambient herbivory rate
p <- 0.5 #Algal protection; degree to which ambient herbivory is reduced for protected macroalgae

```


#Testing scenarios with macroalgae growth rate used by Kopecky et al (2023)
#Strcuture retaining
```{r}
# create a vector of timesteps
tset1 <- seq(from = 0, to = 1000, length.out = 10005)

# store colors for variables
CLcol <- 'coral'
CDcol <- 'brown'
CPcol <- 'pink'
MEcol <- 'seagreen'
MPcol <- 'green'
Scol <- 'gray'

```



##########################


# Extension- temperature dependent growth
#Structure retaining
```{r}
# Convert 7-month growth rates to annual rates from Merck et al (2022)
# Growth rates at 25C and 29C (converted to annual rates)
gc_25 <- 13.3  # Growth at 25C = 1,330% change in proportional cover annually
gc_29 <- 9.63  # Growth at 29C= 963% change in proportional cover annually

# Define linear function gc(T) = m*T + b
m <- (gc_29 - gc_25) / (29 - 25)  # Slope
b <- gc_25 - m * 25  # Intercept

gc_function <- function(T) {
  return(m * T + b)  # Linear function for gc based on temperature
}

# Create a temperature vector (example: seasonal variation)
Tset <- seq(24, 30, length.out = length(tset1))  # Range from 24C to 30C



# create holding vectors and fill initial conditions - inital conditions represent proportional cover of the benthos
CL.simu.ext <- NaN*tset1; CL.simu.ext[1] <- 0.02  #live coral
CD.simu.ext <- NaN*tset1; CD.simu.ext[1] <- 0.7 #dead coral
CP.simu.ext <- NaN*tset1; CP.simu.ext[1] <- 0 #live coral on dead coral
ME.simu.ext <- NaN*tset1; ME.simu.ext[1] <- 0.1 #exposed macroalgae
MP.simu.ext <- NaN*tset1; MP.simu.ext[1] <- 0.18 #protected macroalgae
S.simu.ext <- NaN*tset1; S.simu.ext[1] <- 0 #empty space



# Loop through timesteps
for(i in 2:length(tset1)){
  dt <- tset1[i] - tset1[i-1]

  # Get current temperature and calculate gc
  T_current <- Tset[i]
  gc <- gc_function(T_current)

  # Store previous timestep values
  CL <- CL.simu.ext[i-1]
  CD <- CD.simu.ext[i-1]
  CP <- CP.simu.ext[i-1]
  ME <- ME.simu.ext[i-1]
  MP <- MP.simu.ext[i-1]
  S <- S.simu.ext[i-1]

  # Compute changes using temperature-dependent gc
  dCL <- (gc * CL * S + gammaC * S - gmc * CL * (ME + MP) - dc * CL) * dt
  dCD <- (dc * (CL + CP) + MP * (h * (1 - p) + dm) - gc * CP * CD - settlement * gammaC * CD - gm * CD * (ME + MP) - gammaM * CD - e * CD) * dt
  dCP <- (gc * CP * CD + settlement * gammaC * CD - gmc * CP * (ME + MP) - dc * CP - e * CP) * dt
  dME <- (gm * ME * S + gm * MP * S + gammaM * S - ME * (h + dm)) * dt
  dMP <- (gm * MP * CD + gm * ME * CD + gmc * CL * (ME + MP) + gmc * CP * (ME + MP) + gammaM * CD - MP * (h * (1 - p) + dm + e)) * dt
  dS <- (1 - CL - CD - CP - ME - MP) * dt  # Ensure total proportion remains 1

  # Update states
  CL.simu.ext[i] <- CL + dCL
  CD.simu.ext[i] <- CD + dCD
  CP.simu.ext[i] <- CP + dCP
  ME.simu.ext[i] <- ME + dME
  MP.simu.ext[i] <- MP + dMP
  S.simu.ext[i] <- S + dS
}

```


#Extension- retaining plots
```{r}
# plot coral as a function of time
plot(x = tset1, y = CL.simu.ext,
     type = 'l', las = 1, lwd = 2, col = CLcol,
     ylim = c(0, 1),
     xlim= c(0, 50),
     xlab = 'Time', ylab = 'Population Size',
     main = "Extension- Coral community after structure removing disturbance")
 lines(x = tset1, y = CD.simu.ext,
      lwd = 2, col = CDcol)
 lines(x = tset1, y = CP.simu.ext,
      lwd = 2, col = CPcol )
 legend(x = 'topright', legend = c('CL', 'CD', 'CP'), lwd = 5, col = c(CLcol, CDcol, CPcol))

# plot population macroalgae as a function of time
plot(x = tset1, y = ME.simu.ext,
     type = 'l', las = 1, lwd = 2, col = MEcol,
     xlab = 'Time', ylab = 'Population Size',
     main = "Extension- Macroalgal community after structure removing disturbance")
lines(x = tset1, y = MP.simu.ext,
      lwd = 2, col = MPcol)
legend(x = 'topright', legend = c('ME', 'MP'), lwd = 5, col = c(MEcol, MPcol))

# plot open space as a function of time
plot(x = tset1, y = S.simu.ext,
     type = 'l', las = 1, lwd = 2, col = "grey",
     xlab = 'Time', ylab = 'Population Size',
     main = "Extension- Empty space after structure removing disturbance")
legend(x = 'topright', legend = c('open space'), lwd = 5)
```


```{r}
# Load necessary library
library(ggplot2)



# Growth rates at 25C and 29C (converted to annual rates)
gc_25 <- 13.3  # Growth at 25C
gc_29 <- 9.63  # Growth at 29C

# Define linear function gc(T) = m*T + b
m <- (gc_29 - gc_25) / (29 - 25)  # Slope
b <- gc_25 - m * 25  # Intercept

gc_function <- function(T) {
  return(m * T + b)  # Temperature-dependent growth rate
}

# Define different temperature scenarios
T_constant_26 <- rep(26, 10005)  # Constant temperature at 26°C
T_constant_28 <- rep(28, 10005)  # Constant temperature at 28°C
T_seasonal <- 26 + 2 * sin(seq(0, 2 * pi, length.out = 10005))  # Seasonal variation (±2°C around 26°C)

# Function to simulate coral cover over time for a given temperature scenario
simulate_coral_growth <- function(Tset) {
  # Create a vector of timesteps
  tset1 <- seq(from = 0, to = 1000, length.out = 10005)

  # Create holding vectors and set initial conditions
  CL.simu1 <- NaN*tset1; CL.simu1[1] <- 0.02  # Live coral
  CD.simu1 <- NaN*tset1; CD.simu1[1] <- 0.7   # Dead coral
  CP.simu1 <- NaN*tset1; CP.simu1[1] <- 0     # Live coral on dead coral
  ME.simu1 <- NaN*tset1; ME.simu1[1] <- 0.1   # Exposed macroalgae
  MP.simu1 <- NaN*tset1; MP.simu1[1] <- 0.18  # Protected macroalgae
  S.simu1 <- NaN*tset1; S.simu1[1] <- 0       # Empty space

  # Parameters (change in proportional cover per year)
  gm <- 0.6   # Growth rate of macroalgae
  gmc <- 0.06 # Overgrowth rate of macroalgae onto live coral
  dc <- 0.001 # Death rate of coral
  dm <- 0.05  # Senescence rate of macroalgae
  e <- 0.01   # Erosion rate of dead coral
  gammaC <- 0.001 # Open settlement rate of coral
  settlement <- 1  # Multiplier for coral settlement onto dead coral
  gammaM <- 0.001 # Open settlement rate of macroalgae
  h <- 0.3   # Ambient herbivory rate
  p <- 0.5   # Algal protection factor

  # Loop through timesteps
  for(i in 2:length(tset1)){
    dt <- tset1[i] - tset1[i-1]  # Change in time

    # Get current temperature and calculate gc
    T_current <- Tset[i]
    gc <- gc_function(T_current)  # Temperature-dependent growth rate

    # Store previous values
    CL <- CL.simu1[i-1]
    CD <- CD.simu1[i-1]
    CP <- CP.simu1[i-1]
    ME <- ME.simu1[i-1]
    MP <- MP.simu1[i-1]
    S <- S.simu1[i-1]

    # Compute changes
    dCL <- (gc * CL * S + gammaC * S - gmc * CL * (ME + MP) - dc * CL) * dt
    dCD <- (dc * (CL + CP) + MP * (h * (1 - p) + dm) - gc * CP * CD - settlement * gammaC * CD - gm * CD * (ME + MP) - gammaM * CD - e * CD) * dt
    dCP <- (gc * CP * CD + settlement * gammaC * CD - gmc * CP * (ME + MP) - dc * CP - e * CP) * dt
    dME <- (gm * ME * S + gm * MP * S + gammaM * S - ME * (h + dm)) * dt
    dMP <- (gm * MP * CD + gm * ME * CD + gmc * CL * (ME + MP) + gmc * CP * (ME + MP) + gammaM * CD - MP * (h * (1 - p) + dm + e)) * dt
    dS <- (1 - CL - CD - CP - ME - MP) * dt  # Ensure total proportion remains 1

    # Update values
    CL.simu1[i] <- CL + dCL
    CD.simu1[i] <- CD + dCD
    CP.simu1[i] <- CP + dCP
    ME.simu1[i] <- ME + dME
    MP.simu1[i] <- MP + dMP
    S.simu1[i] <- S + dS
  }

  # Return results
  return(data.frame(Time = tset1, CL = CL.simu1))
}

# Run simulations for different temperature scenarios
sim_constant_26 <- simulate_coral_growth(T_constant_26)
sim_constant_28 <- simulate_coral_growth(T_constant_28)
sim_seasonal <- simulate_coral_growth(T_seasonal)

# Combine data for plotting
sim_constant_26$Scenario <- "Constant 26°C"
sim_constant_28$Scenario <- "Constant 28°C"
sim_seasonal$Scenario <- "Seasonal (±2°C around 26°C)"

all_sims <- rbind(sim_constant_26, sim_constant_28, sim_seasonal)

# Plot results
ggplot(all_sims, aes(x = Time, y = CL, color = Scenario)) +
  geom_line(size = 1) +
  labs(title = "Coral Cover (CL) Over Time Under Different Temperature Scenarios",
       x = "Time (years)",
       y = "Proportional Coral Cover (CL)") +
  theme_minimal() +
  scale_color_manual(values = c("blue", "red", "green"))

```






